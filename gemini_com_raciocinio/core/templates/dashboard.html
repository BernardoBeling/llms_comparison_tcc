{% extends 'base.html' %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 30px;">
    <div>
        <h2 style="margin: 0;">Painel de Controle Industrial</h2>
        <p style="color: #666;">Gerenciamento de ativos e ordens em tempo real.</p>
    </div>
    
    <div style="display: flex; gap: 15px;">
        <div class="card" style="padding: 15px; border-top: 4px solid #3498db; min-width: 140px; text-align: center;">
            <span style="font-size: 0.85em; text-transform: uppercase; color: #7f8c8d;">Produ√ß√µes Ativas</span><br>
            <strong style="font-size: 1.8em; color: #2c3e50;">{{ active_count }}</strong>
        </div>
        <div class="card" style="padding: 15px; border-top: 4px solid #e67e22; min-width: 140px; text-align: center;">
            <span style="font-size: 0.85em; text-transform: uppercase; color: #7f8c8d;">M√°quinas em Uso</span><br>
            <strong style="font-size: 1.8em; color: #d35400;">{{ machines_used }}</strong>
        </div>
        <div class="card" style="padding: 15px; border-top: 4px solid #2ecc71; min-width: 140px; text-align: center;">
            <span style="font-size: 0.85em; text-transform: uppercase; color: #7f8c8d;">M√°quinas Livres</span><br>
            <strong style="font-size: 1.8em; color: #27ae60;">{{ machines_available }}</strong>
        </div>
    </div>
</div>

<div style="background: #fdfdfd; padding: 20px; border-radius: 8px; border: 1px dashed #ccc; margin-bottom: 30px; display: flex; gap: 15px;">
    <a href="{% url 'machine_create' %}" class="btn btn-blue" style="text-decoration: none;">+ Cadastrar Novo Equipamento</a>
    <a href="{% url 'production_create' %}" class="btn btn-green" style="text-decoration: none;">+ Abrir Ordem de Produ√ß√£o</a>
</div>

<h3>Monitoramento de Produ√ß√£o</h3>
<table style="width: 100%; border-collapse: collapse; background: white; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
    <thead style="background: #f8f9fa;">
        <tr>
            <th style="padding: 12px; text-align: left; border-bottom: 2px solid #dee2e6;">Ordem de Servi√ßo</th>
            <th style="padding: 12px; text-align: left; border-bottom: 2px solid #dee2e6;">Status Geral</th>
            <th style="padding: 12px; text-align: left; border-bottom: 2px solid #dee2e6;">Maquin√°rio e Opera√ß√£o</th>
            <th style="padding: 12px; text-align: left; border-bottom: 2px solid #dee2e6;">A√ß√µes Dispon√≠veis</th>
        </tr>
    </thead>
    <tbody>
        {% for p in productions %}
        <tr style="border-bottom: 1px solid #eee;">
            <td style="padding: 12px;">
                <strong>{{ p.description }}</strong><br>
                <small style="color: #666;">Meta: {{ p.quantity }} unidades</small>
            </td>
            <td style="padding: 12px;">
                <span class="badge {{ p.status|lower }}" style="padding: 5px 10px; border-radius: 4px; font-weight: bold;">
                    {{ p.status }}
                </span>
            </td>
            <td style="padding: 12px;">
                <div style="display: flex; flex-direction: column; gap: 8px;">
                    {% for pm in p.productionmachine_set.all %}
                    <div style="background: #fcfcfc; padding: 8px; border-radius: 4px; border: 1px solid #f0f0f0;">
                        <strong>{{ pm.machine.model }}</strong> <small>({{ pm.machine.serialnumber }})</small><br>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 4px;">
                            <span>üïí {{ pm.working_time }} min</span>
                            <span class="badge {{ pm.status|lower }}" style="font-size: 0.75em;">{{ pm.status }}</span>
                        </div>
                        
                        {% if p.status == 'ONGOING' and pm.status == 'ONGOING' %}
                        <div style="margin-top: 8px; border-top: 1px solid #eee; padding-top: 5px;">
                            <a href="{% url 'update' pm.pk 'machine' 'FINISHED' %}" style="color: #27ae60; font-size: 0.8em; text-decoration: none; margin-right: 10px;">‚úî Finalizar</a>
                            <a href="{% url 'update' pm.pk 'machine' 'CANCELED' %}" style="color: #e74c3c; font-size: 0.8em; text-decoration: none;">‚úñ Cancelar</a>
                        </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            </td>
            <td style="padding: 12px;">
                {% if p.status == 'STANDBY' %}
                    <a href="{% url 'update' p.pk 'production' 'ONGOING' %}" class="btn btn-blue" style="display: block; text-align: center; margin-bottom: 5px;">üöÄ Iniciar Produ√ß√£o</a>
                {% elif p.status == 'ONGOING' %}
                    <a href="{% url 'update' p.pk 'production' 'FINISHED' %}" class="btn btn-green" style="display: block; text-align: center; margin-bottom: 5px;">üèÅ Finalizar Ordem</a>
                {% endif %}

                {% if p.status != 'FINISHED' and p.status != 'CANCELED' %}
                    <a href="{% url 'update' p.pk 'production' 'CANCELED' %}" class="btn btn-red" style="display: block; text-align: center;">üö´ Cancelar Total</a>
                {% endif %}
            </td>
        </tr>
        {% empty %}
        <tr><td colspan="4" style="padding: 20px; text-align: center; color: #999;">Nenhuma ordem registrada no sistema.</td></tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}